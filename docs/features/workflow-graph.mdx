---
title: Graph Visualization
description: Interactive workflow visualization using JointJS
---
# Workflow Graph Visualization

## Overview

The workflow visualization system uses **JointJS** to create interactive representations of Zuora workflows in the "Graphical View" tab of the workflow detail page.

## Technologies Used

- **JointJS** (v4.x): Library for creating interactive diagrams
- **Dagre**: Automatic layout algorithm for directed graphs
- **jQuery, Backbone, Lodash**: Required JointJS dependencies

## Struttura File

```
resources/
├── js/
│   ├── app.js                          # Entry point, espone initWorkflowGraph
│   └── components/
│       └── workflow-graph.js           # Logica principale del grafo
├── css/
│   └── app.css                         # Importa gli stili JointJS
└── views/
    └── filament/
        └── components/
            └── workflow-graph.blade.php # Componente Blade per il rendering

app/Filament/Resources/Workflows/Pages/
└── ViewWorkflow.php                     # Integrazione nel tab Graphical View
```

## Features

### 1. Workflow JSON Parsing

The system supports the Zuora Workflow format with:

- **tasks**: Array of tasks with:
  - `id`: Unique identifier
  - `name`: Task name
  - `action_type`: Action type (Export, Iterate, Cancel, Create, Update, etc.)
  - `css`: Optional positions (top, left)

- **linkages**: Array of connections with:
  - `source_workflow_id`: Source workflow ID (null for tasks)
  - `source_task_id`: Source task ID (null for start)
  - `target_task_id`: Target task ID
  - `linkage_type`: Connection type (Success, For Each, Start, etc.)

### 2. Node Visualization

Each node is colored based on action type:

| Action Type | Color | Hex |
|------------|--------|-----|
| Export | Blue | #3b82f6 |
| Iterate | Orange | #f59e0b |
| Cancel | Red | #ef4444 |
| Create | Green | #10b981 |
| Update | Purple | #8b5cf6 |
| Delete | Dark Red | #dc2626 |
| Query | Cyan | #06b6d4 |
| Callout | Pink | #ec4899 |
| Email | Yellow | #fbbf24 |
| Wait | Gray | #6b7280 |
| Start | Green | #10b981 |
| End | Red | #ef4444 |

### 3. Automatic Layout

The system uses the **Dagre** algorithm to:
- Organize nodes hierarchically (top-to-bottom)
- Avoid overlaps
- Optimize graph readability

Layout parameters:
```javascript
{
    rankdir: 'TB',      // Top to Bottom
    nodesep: 80,        // Node separation
    edgesep: 80,        // Edge separation
    ranksep: 100,       // Level separation
    marginx: 50,        // Horizontal margin
    marginy: 50         // Vertical margin
}
```

### 4. Interactive Controls

#### Zoom
- **Zoom In**: + button or scroll wheel up
- **Zoom Out**: - button or scroll wheel down
- **Reset Zoom**: Reset button (returns to 1:1 scale)
- **Range**: 0.2x - 3x

#### Pan (Movement)
- **Mouse Drag**: Click and drag to move the graph
- **Cursor**: Changes to "grabbing" during drag

### 5. Special Nodes

- **Start Node**: Automatically created, represents workflow start
- **End Node**: Automatically created, connects all terminal tasks

## Integrazione in Filament

### ViewEntry Component

```php
\Filament\Infolists\Components\ViewEntry::make('workflow_graph')
    ->hiddenLabel()
    ->view('filament.components.workflow-graph', [
        'workflowData' => $this->record->json_export,
    ])
```

### Blade Component

Il componente utilizza Alpine.js per l'inizializzazione:

```blade
<div x-data="{ 
    init() {
        if (window.initWorkflowGraph && this.$refs.graphContainer) {
            window.initWorkflowGraph('workflow-graph-container', @js($workflowData));
        }
    }
}" x-ref="graphContainer">
    <div id="workflow-graph-container"></div>
</div>
```

## Supported JSON Formats

### 1. Zuora Format (Primary)

```json
{
    "tasks": [
        {
            "id": 1,
            "name": "Export Data",
            "action_type": "Export",
            "css": { "top": "100px", "left": "200px" }
        }
    ],
    "linkages": [
        {
            "source_workflow_id": 1,
            "source_task_id": null,
            "target_task_id": 1,
            "linkage_type": "Start"
        }
    ]
}
```

### 2. Generic Format (Fallback)

```json
{
    "nodes": [
        { "id": "node1", "name": "Node 1", "type": "task" }
    ],
    "connections": [
        { "source": "start", "target": "node1", "label": "Begin" }
    ]
}
```

## Build and Deploy

### Asset Compilation

```bash
# Development
yarn dev

# Production
yarn build

# With Lando
lando yarn build
```

### Installation Verification

```bash
# Check dependencies
yarn list --pattern "jointjs|dagre"

# Expected output:
# ├─ dagre@0.8.5
# ├─ jointjs@4.x.x
```

## Troubleshooting

### Graph Not Displayed

1. **Check browser console**: Open DevTools → Console
2. **Check compiled assets**: `public/build/assets/app-*.js` must exist
3. **Verify workflow JSON**: `json_export` must be populated

### Layout Not Applied

- Dagre layout is applied only after complete loading
- Verify all nodes have valid dimensions
- Check linkages have valid source/target

### Zoom Controls Not Working

- Verify buttons have correct IDs: `zoom-in-btn`, `zoom-out-btn`, `zoom-reset-btn`
- Check for conflicts with other event listeners

### Import Errors

If you see errors like `"ui" is not exported by jointjs`:
- JointJS UI is a separate package (not included)
- System uses only basic JointJS functionality

## Performance

### Implemented Optimizations

1. **Lazy Loading**: Graphical View tab is loaded only when selected
2. **Layout Cache**: Calculated positions are reused
3. **Optimized Render**: JointJS uses SVG for better performance

### Recommended Limits

- **Tasks**: < 100 nodes for optimal performance
- **Connections**: < 200 edges per graph
- **Complexity**: Linear or tree layout works better than cyclic graphs

## Future Extensions

Possible improvements:

1. **Graph Export**: Save graph as PNG/SVG
2. **Interactive Editing**: Drag-and-drop node editing
3. **Filters**: Show/hide specific task types
4. **Minimap**: Navigation on large graphs
5. **Advanced Tooltips**: Show task details on hover
6. **Smart Connectors**: Automatic edge routing
7. **Grouping**: Group related tasks

## Riferimenti

- [JointJS Documentation](https://resources.jointjs.com/docs/jointjs)
- [Dagre Layout Algorithm](https://github.com/dagrejs/dagre)
- [Filament Documentation](https://filamentphp.com/docs)
