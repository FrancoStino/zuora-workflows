---
title: API Reference
description: REST API endpoints and Zuora integration details
---

import { APIEndpoint } from '@/components/api-endpoint'
import { ServiceAPI } from '@/components/service-api'
import { ZuoraIntegration } from '@/components/zuora-integration'
import { ExceptionHandling } from '@/components/exception-handling'
import { PaginationInfo } from '@/components/pagination-info'
import { RateLimiting } from '@/components/rate-limiting'
import { BestPractices } from '@/components/best-practices'
import { NextSteps } from '@/components/next-steps'

# API Reference

This document describes REST API endpoints and Zuora integration details.

## Internal API Endpoints

### Authentication

All API endpoints require authentication via Laravel Sanctum.

<CodeBlock
  title="Authentication Headers"
  code={`Authorization: Bearer {token}
Content-Type: application/json`}
  language="http"
/>

### API Endpoints

<APIEndpoint
  title="Get Authenticated User"
  method="GET"
  path="/api/user"
  auth={true}
  response={`{
  "id": 1,
  "name": "John Doe",
  "email": "john@example.com",
  "role": {
    "id": 1,
    "name": "super_admin"
  }
}`}
  description="Retrieve information about currently authenticated user"
/>

<APIEndpoint
  title="Get Zuora Access Token"
  method="GET"
  path="/api/zuora/token"
  auth={true}
  response={`{
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}`}
  error={`{
  "error": "Failed to authenticate with Zuora: invalid_client"
}`}
  statusCodes={[
    { code: 200, description: 'Token generated successfully' },
    { code: 500, description: 'Authentication failed' }
  ]}
  description="Generate a new Zuora OAuth 2.0 access token. Tokens are cached for 1 hour on server side."
/>

<APIEndpoint
  title="Download Workflow JSON"
  method="GET"
  path="/api/zuora/download/{workflowId}"
  auth={true}
  queryParams={[
    { name: 'client_id', type: 'string', required: true, description: 'Zuora OAuth client ID' },
    { name: 'client_secret', type: 'string', required: true, description: 'Zuora OAuth client secret' },
    { name: 'base_url', type: 'string', required: false, description: 'Zuora API base URL (default: https://rest.zuora.com)' }
  ]}
  response={`{
  "id": "2c92c0f9567d5b5c01567df6a2a6002c",
  "name": "Invoice Processing",
  "description": "Process invoices automatically",
  "status": "Active",
  "tasks": [
    {
      "id": "2c92c0f9567d5b5c01567df6a2c8002d",
      "name": "Query Invoices",
      "action_type": "Query",
      "object": "Invoice",
      "call_type": "query",
      "priority": "High",
      "parameters": {
        "where_clause": "Status = 'Posted'"
      }
    }
  ],
  "linkages": [
    {
      "source_task_id": "2c92c0f9567d5b5c01567df6a2c8002d",
      "target_task_id": "2c92c0f9567d5b5c01567df6a2d1002e",
      "linkage_type": "Success"
    }
  ]
}`}
  statusCodes={[
    { code: 200, description: 'Workflow JSON retrieved' },
    { code: 401, description: 'Invalid credentials' },
    { code: 404, description: 'Workflow does not exist' },
    { code: 500, description: 'API error' }
  ]}
  description="Download complete JSON export of a specific workflow from Zuora"
/>

## Zuora REST API Integration

<ZuoraIntegration />

### Authentication Flow

<CodeBlock
  title="OAuth 2.0 Client Credentials"
  code={`POST {base_url}/oauth/token
Content-Type: application/x-www-form-urlencoded

grant_type=client_credentials
&client_id={client_id}
&client_secret={client_secret}`}
  language="http"
/>

<CodeBlock
  title="OAuth Response"
  code={`{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "token_type": "Bearer",
  "expires_in": 3600,
  "scope": null
}`}
  language="json"
/>

<Alert type="info">
  <strong>Token Caching:</strong>
  <ul className="list-disc list-inside mt-2 space-y-1">
    <li>Tokens are cached for 3600 seconds (1 hour)</li>
    <li>Cache key: zuora_access_token_{md5(client_id + client_secret)}</li>
    <li>Tokens are automatically refreshed on expiration</li>
  </ul>
</Alert>

### Workflows Endpoint

<APIEndpoint
  title="List Workflows"
  method="GET"
  path="{base_url}/workflows"
  auth={true}
  headers={`Authorization: Bearer {access_token}
Accept: application/json`}
  queryParams={[
    { name: 'page', type: 'integer', default: '1', description: 'Page number (starts at 1)' },
    { name: 'page_length', type: 'integer', default: '50', description: 'Items per page (max: 50)' }
  ]}
  response={`{
  "data": [
    {
      "id": "2c92c0f9567d5b5c01567df6a2a6002c",
      "name": "Invoice Processing",
      "description": "Process invoices automatically",
      "status": "Active",
      "type": "Workflow::Setup",
      "timezone": "America/Los_Angeles",
      "createdAt": "2024-11-01T00:00:00Z",
      "updatedAt": "2024-12-01T00:00:00Z",
      "calloutTrigger": false,
      "ondemandTrigger": true,
      "scheduledTrigger": false
    }
  ],
  "pagination": {
    "next_page": 2,
    "total_count": 150,
    "page": 1,
    "page_length": 50
  }
}`}
  description="Retrieve workflows from Zuora API"
/>

<APIEndpoint
  title="Download Workflow Export"
  method="GET"
  path="{base_url}/workflows/{workflowId}/export"
  auth={true}
  headers={`Authorization: Bearer {access_token}
Accept: application/json`}
  pathParams={[
    { name: 'workflowId', type: 'string', required: true, description: 'Zuora workflow ID' }
  ]}
  description="Download complete workflow definition including tasks and connections"
/>

## Service Layer API

<ServiceAPI
  title="ZuoraService"
  methods={[
    {
      name: 'getAccessToken',
      signature: 'public function getAccessToken(?string $clientId = null, ?string $clientSecret = null, ?string $baseUrl = null): string',
      description: 'Generate OAuth 2.0 access token for Zuora API',
      parameters: [
        { name: '$clientId', type: 'string', description: 'Zuora OAuth client ID' },
        { name: '$clientSecret', type: 'string', description: 'Zuora OAuth client secret' },
        { name: '$baseUrl', type: 'string', description: 'Zuora API base URL' }
      ],
      returns: 'Access token string',
      throws: ['ZuoraAuthenticationException']
    },
    {
      name: 'listWorkflows',
      signature: 'public function listWorkflows(string $clientId, string $clientSecret, string $baseUrl = \'https://rest.zuora.com\', int $page = 1, int $pageSize = 12): array',
      description: 'Retrieve paginated list of workflows from Zuora',
      parameters: [
        { name: '$clientId', type: 'string', description: 'Zuora OAuth client ID' },
        { name: '$clientSecret', type: 'string', description: 'Zuora OAuth client secret' },
        { name: '$baseUrl', type: 'string', description: 'Zuora API base URL' },
        { name: '$page', type: 'int', description: 'Page number (default: 1)' },
        { name: '$pageSize', type: 'int', description: 'Items per page (default: 12, max: 50)' }
      ],
      returns: `['data' => [...], 'pagination' => [...]]`,
      throws: ['ZuoraHttpException']
    },
    {
      name: 'downloadWorkflow',
      signature: 'public function downloadWorkflow(string $clientId, string $clientSecret, string $baseUrl, string|int $workflowId): array',
      description: 'Download complete workflow JSON export',
      parameters: [
        { name: '$clientId', type: 'string', description: 'Zuora OAuth client ID' },
        { name: '$clientSecret', type: 'string', description: 'Zuora OAuth client secret' },
        { name: '$baseUrl', type: 'string', description: 'Zuora API base URL' },
        { name: '$workflowId', type: 'string|int', description: 'Zuora workflow ID' }
      ],
      returns: 'Complete workflow array with tasks and linkages',
      throws: ['ZuoraHttpException']
    }
  ]}
/>

<ServiceAPI
  title="WorkflowSyncService"
  methods={[
    {
      name: 'syncCustomerWorkflows',
      signature: 'public function syncCustomerWorkflows(Customer $customer): array',
      description: 'Synchronize all workflows for a customer from Zuora',
      parameters: [
        { name: '$customer', type: 'Customer', description: 'Customer model instance' }
      ],
      returns: `{
  'created' => 5,     // Number of workflows created
  'updated' => 10,    // Number of workflows updated
  'deleted' => 2,     // Number of workflows deleted
  'total' => 15,       // Total workflows processed
  'errors' => []       // Array of error messages
}`,
      process: [
        'Validates customer credentials',
        'Fetches workflows from Zuora (paginated)',
        'Creates/updates workflow records',
        'Downloads workflow JSON',
        'Extracts tasks from JSON',
        'Deletes stale workflows',
        'Returns statistics'
      ]
    }
  ]}
/>

## Artisan Commands

### Sync Workflows

<CodeBlock
  title="Sync Workflows Command"
  code={`# Sync specific customer
php artisan app:sync-workflows --customer="Acme Corp"

# Sync all customers
php artisan app:sync-workflows --all

# Sync synchronously (immediate processing)
php artisan app:sync-workflows --all --sync`}
  language="bash"
/>

<DataTable
  columns={['Option', 'Required', 'Description']}
  rows={[
    ['--customer={name}', 'No', 'Sync workflows for specific customer by name'],
    ['--all', 'No', 'Sync workflows for all customers'],
    ['--sync', 'No', 'Run synchronously (bypass queue)']
  ]}
/>

### Sync Workflow Tasks

<CodeBlock
  title="Sync Tasks Command"
  code={`# Re-extract tasks for all workflows
php artisan workflows:sync-tasks --all

# Re-extract tasks for specific workflow
php artisan workflows:sync-tasks --workflow-id=123`}
  language="bash"
/>

<DataTable
  columns={['Option', 'Required', 'Description']}
  rows={[
    ['--all', 'No', 'Re-extract tasks for all workflows'],
    ['--workflow-id={id}', 'No', 'Re-extract tasks for specific workflow ID']
  ]}
/>

## Error Handling

<ExceptionHandling />

### Exception Types

<DataTable
  columns={['Exception', 'Message', 'HTTP Status', 'Description']}
  rows={[
    ['ZuoraAuthenticationException', 'Failed to authenticate with Zuora: {error}', 401, 'OAuth authentication failed'],
    ['ZuoraHttpException', 'Zuora API error ({code}): {message}', '4xx/5xx', 'HTTP request failed'],
    ['SetupException', 'Application setup not completed', 302, 'Setup wizard required']
  ]}
/>

<CodeExample
  title="Error Handling Examples"
  steps={[
    {
      title: 'Catch Authentication Exception',
      code: `use App\\Exceptions\\ZuoraAuthenticationException;

try {
    \$token = \$service->getAccessToken(...);
} catch (ZuoraAuthenticationException \$e) {
    // Handle invalid credentials
    Log::error('Auth failed: ' . \$e->getMessage());
}`,
      language: 'php'
    },
    {
      title: 'Catch HTTP Exception',
      code: `use App\\Exceptions\\ZuoraHttpException;

try {
    \$workflows = \$service->listWorkflows(...);
} catch (ZuoraHttpException \$e) {
    // Handle API errors
    Log::error('API failed: ' . \$e->getMessage());
}`,
      language: 'php'
    }
  ]}
/>

## Pagination

<PaginationInfo />

### Workflow List Pagination

<Alert type="info">
  <strong>Zuora API Pagination:</strong> Uses offset-based pagination
</Alert>

<DataTable
  columns={['Parameter', 'Description']}
  rows={[
    ['page', 'Page number (1-based)'],
    ['page_length', 'Items per page (max: 50)']
  ]}
/>

<CodeBlock
  title="Paginated Loop Implementation"
  code={`\$page = 1;
\$hasMore = true;

while (\$hasMore) {
    \$data = \$zuoraService->listWorkflows(..., \$page, 50);

    // Process workflows
    foreach (\$data['data'] as \$workflow) {
        // Process workflow
    }

    // Check for more pages
    \$pagination = \$data['pagination'] ?? [];
    \$hasMore = isset(\$pagination['next_page']);
    \$page++;
}`}
  language="php"
/>

## Rate Limiting

<RateLimiting />

<DataTable
  columns={['Limit', 'Value']}
  rows={[
    ['Requests per hour per tenant', '1000'],
    ['Concurrent connections', '200']
  ]}
/>

<Alert type="warning">
  <strong>Handling:</strong>
  <ul className="list-disc list-inside mt-2 space-y-1">
    <li>Application caches access tokens (reduces auth requests)</li>
    <li>Implement exponential backoff for failed requests</li>
    <li>Queue jobs with 60-second retry delay</li>
  </ul>
</Alert>

## Best Practices

<BestPractices
  sections={[
    {
      title: 'Token Management',
      items: [
        'Cache Tokens: Always cache access tokens to reduce API calls',
        'Handle Expiration: Check token expiration and refresh gracefully',
        'Secure Storage: Store client secrets encrypted at rest'
      ]
    },
    {
      title: 'Error Handling',
      items: [
        'Catch Exceptions: Always wrap API calls in try-catch blocks',
        'Log Errors: Log full error messages for debugging',
        'User Feedback: Display user-friendly error messages'
      ]
    },
    {
      title: 'Performance',
      items: [
        'Batch Operations: Use pagination for large datasets',
        'Queue Processing: Use background jobs for sync operations',
        'Cache Responses: Cache expensive API responses'
      ]
    }
  ]}
/>

<NextSteps
  links={[
    { title: 'Configuration Reference', href: '../reference/configuration', description: 'Configure API settings' },
    { title: 'Features Guide', href: '../guides/features', description: 'Learn about features' },
    { title: 'Development Guide', href: '../guides/development', description: 'Development workflow' }
  ]}
/>

## Related Resources

<LinksGrid
  links={[
    { title: 'Zuora REST API Documentation', url: 'https://knowledgecenter.zuora.com/Zuora_Central_Platform/API/Zuora_REST_API', icon: 'ðŸ”Œ' },
    { title: 'Zuora OAuth Guide', url: 'https://knowledgecenter.zuora.com/Zuora_Central_Platform/API/Client_Authentication', icon: 'ðŸ”' },
    { title: 'Laravel HTTP Client', url: 'https://laravel.com/docs/12.x/http-client', icon: 'ðŸ“¡' }
  ]}
/>
