---
title: Deployment Guide
description: Production deployment and CI/CD pipeline setup
---

# Deployment Guide

This guide covers deploying Zuora Workflow Manager to production environments.

## Deployment Overview

The application is designed to be deployed to standard PHP hosting environments. The project includes GitHub Actions workflow for automated deployment to production.

### Deployment Methods

- **Option A**: GitHub Actions CI/CD (recommended)
- **Option B**: Manual deployment via SSH/FTP
- **Option C**: Platform-specific deployment (Forge, Vapor, etc.)

---

## Prerequisites

### Server Requirements

| Requirement | Version | Description |
|-------------|---------|-------------|
| PHP | 8.4+ | Application runtime |
| Composer | 2.x | Dependency management |
| Node.js | 24.0+ | Asset building |
| Yarn | Latest | Package management |
| MariaDB | 11.4+ | Database |
| Redis | 7.0+ | Queue/cache (recommended) |
| Nginx/Apache | Latest | Web server |
| SSL Certificate | - | HTTPS (required) |

### PHP Extensions

Required PHP extensions:

```bash
php -m | grep -E "(mbstring|openssl|pdo|tokenizer|xml|ctype|json|bcmath|redis)"
```

Required extensions:
- `bcmath`
- `ctype`
- `fileinfo`
- `json`
- `mbstring`
- `openssl`
- `pdo`
- `tokenizer`
- `xml`
- `redis` (optional, recommended)

---

## Option A: GitHub Actions Deployment

### Setup Repository Secrets

Navigate to GitHub repository → Settings → Secrets and variables → Actions

Add the following secrets:

| Secret | Value | Description |
|--------|--------|-------------|
| `SSH_PRIVATE_KEY` | Private SSH key | For server access |
| `SSH_HOST` | Server IP/hostname | Deployment target |
| `SSH_USERNAME` | SSH username | Deployment user |
| `APP_KEY` | Laravel APP_KEY | Application key |
| `DB_DATABASE` | Database name | Production database |
| `DB_USERNAME` | Database username | Database user |
| `DB_PASSWORD` | Database password | Database password |
| `DB_HOST` | Database host | Database server |

### Deployment Workflow

The project includes `.github/workflows/deploy.yml` workflow:

**Trigger:**
- Manual dispatch from GitHub Actions tab
- On push to `main` branch (if configured)

**Process:**
1. Checkout code
2. Setup PHP
3. Install dependencies
4. Build assets
5. Run migrations
6. Clear caches
7. Restart services

**Trigger Deployment:**

1. Navigate to **Actions** tab in GitHub
2. Select **Deploy to Production** workflow
3. Click **Run workflow**
4. Select branch and click **Run workflow**

---

## Option B: Manual Deployment

### Step 1: Prepare Server

SSH into server:

```bash
ssh user@your-server.com
```

Install dependencies:

```bash
# Install PHP (if not installed)
sudo apt install php8.4 php8.4-fpm php8.4-mysql php8.4-xml php8.4-mbstring php8.4-curl php8.4-zip php8.4-bcmath php8.4-intl

# Install Composer
curl -sS https://getcomposer.org/installer | php
sudo mv composer.phar /usr/local/bin/composer

# Install Node.js and Yarn
curl -fsSL https://deb.nodesource.com/setup_24.x | sudo -E bash -
sudo apt-get install -y nodejs
npm install -g yarn

# Install Redis (optional)
sudo apt install redis-server
```

### Step 2: Configure Environment

Clone repository:

```bash
cd /var/www
git clone https://github.com/FrancoStino/zuora-workflows.git zuora-workflows
cd zuora-workflows
```

Copy environment file:

```bash
cp .env.example .env
```

Edit `.env` file:

```env
APP_NAME="Zuora Workflows"
APP_ENV=production
APP_KEY=base64:YOUR_32_CHAR_KEY
APP_DEBUG=false
APP_URL=https://your-domain.com

DB_CONNECTION=mariadb
DB_HOST=localhost
DB_PORT=3306
DB_DATABASE=zuora_workflows
DB_USERNAME=zuora_user
DB_PASSWORD=secure_password

CACHE_STORE=redis
QUEUE_CONNECTION=redis
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
```

Generate application key:

```bash
php artisan key:generate
```

### Step 3: Install Dependencies

```bash
# Install PHP dependencies
composer install --optimize-autoloader --no-dev

# Install Node.js dependencies
yarn install --production
```

### Step 4: Build Assets

```bash
yarn run build
```

### Step 5: Database Setup

Create database:

```bash
mysql -u root -p
```

```sql
CREATE DATABASE zuora_workflows CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'zuora_user'@'localhost' IDENTIFIED BY 'secure_password';
GRANT ALL PRIVILEGES ON zuora_workflows.* TO 'zuora_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

Run migrations:

```bash
php artisan migrate --force
```

### Step 6: Configure Web Server

#### Nginx Configuration

Create `/etc/nginx/sites-available/zuora-workflows`:

```nginx
server {
    listen 80;
    listen [::]:80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name your-domain.com;

    root /var/www/zuora-workflows/public;
    index index.php;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    location / {
        try_files $uri $uri/ /index.php?$query_string;
    }

    location ~ \.php$ {
        fastcgi_pass unix:/var/run/php/php8.4-fpm.sock;
        fastcgi_param SCRIPT_FILENAME $realpath_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location ~ /\.(?!well-known).* {
        deny all;
    }
}
```

Enable site:

```bash
sudo ln -s /etc/nginx/sites-available/zuora-workflows /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

#### Apache Configuration

Create VirtualHost:

```apache
<VirtualHost *:80>
    ServerName your-domain.com
    Redirect permanent / https://your-domain.com/
</VirtualHost>

<VirtualHost *:443>
    ServerName your-domain.com
    DocumentRoot /var/www/zuora-workflows/public

    SSLEngine on
    SSLCertificateFile /path/to/cert.pem
    SSLCertificateKeyFile /path/to/key.pem

    <Directory /var/www/zuora-workflows/public>
        AllowOverride All
        Require all granted
    </Directory>
</VirtualHost>
```

Enable site:

```bash
sudo a2ensite zuora-workflows
sudo systemctl reload apache2
```

### Step 7: Set Permissions

```bash
sudo chown -R www-data:www-data /var/www/zuora-workflows
sudo chmod -R 755 /var/www/zuora-workflows
sudo chmod -R 775 /var/www/zuora-workflows/storage
sudo chmod -R 775 /var/www/zuora-workflows/bootstrap/cache
```

### Step 8: Configure Queue Worker

#### Using Supervisor

Install Supervisor:

```bash
sudo apt install supervisor
```

Create `/etc/supervisor/conf.d/zuora-workflows.conf`:

```ini
[program:zuora-workflows-queue]
process_name=%(program_name)s_%(process_num)02d
command=php /var/www/zuora-workflows/artisan queue:work redis --sleep=3 --tries=3
autostart=true
autorestart=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/var/www/zuora-workflows/storage/logs/queue-worker.log
stopwaitsecs=3600
```

Start Supervisor:

```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start zuora-workflows-queue:*
```

#### Alternative: Cron Job

Add to crontab:

```bash
crontab -e
```

```cron
* * * * * * php /var/www/zuora-workflows/artisan schedule:run >> /dev/null 2>&1
```

---

## Post-Deployment

### Clear Caches

```bash
cd /var/www/zuora-workflows

php artisan cache:clear
php artisan config:clear
php artisan route:clear
php artisan view:clear
```

### Optimize Application

```bash
php artisan config:cache
php artisan route:cache
php artisan view:cache
php artisan event:cache
```

### Create Admin Account

```bash
php artisan tinker
```

```php
>>> \App\Models\User::create([
...     'name' => 'Admin User',
...     'email' => 'admin@your-domain.com',
...     'password' => bcrypt('secure_password'),
... ])
```

### Verify Deployment

Access your domain:

```
https://your-domain.com/admin
```

You should see:
- Login page (or setup wizard if first visit)
- No 404 errors
- Assets loading correctly
- Database connections working

---

## Queue Configuration

### Database Queue (Simple)

Set in `.env`:

```env
QUEUE_CONNECTION=database
```

Run queue worker:

```bash
php artisan queue:work --tries=3 --backoff=60
```

### Redis Queue (Recommended)

Set in `.env`:

```env
QUEUE_CONNECTION=redis
REDIS_HOST=127.0.0.1
REDIS_PORT=6379
```

Run queue worker:

```bash
php artisan queue:work redis --tries=3 --backoff=60
```

---

## Monitoring

### Logs

Application logs: `/var/www/zuora-workflows/storage/logs/laravel.log`

View logs:

```bash
tail -f /var/www/zuora-workflows/storage/logs/laravel.log
```

Queue worker logs (if using Supervisor):

```bash
tail -f /var/www/zuora-workflows/storage/logs/queue-worker.log
```

### Failed Jobs

Check failed jobs:

```bash
php artisan queue:failed
```

Retry failed jobs:

```bash
php artisan queue:retry all
```

---

## Security

### SSL Certificate

Use Let's Encrypt for free SSL:

```bash
sudo apt install certbot python3-certbot-nginx
sudo certbot --nginx -d your-domain.com
```

### Firewall Configuration

Allow only necessary ports:

```bash
sudo ufw allow 22/tcp   # SSH
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS
sudo ufw enable
```

### File Permissions

Restrict access:

```bash
# Make .env and .git inaccessible
chmod 600 /var/www/zuora-workflows/.env
chmod 600 /var/www/zuora-workflows/.git
```

### Security Headers

Add to Nginx config:

```nginx
add_header X-Frame-Options "SAMEORIGIN";
add_header X-XSS-Protection "1; mode=block";
add_header X-Content-Type-Options "nosniff";
add_header Referrer-Policy "strict-origin-when-cross-origin";
add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';";
```

---

## Backup Strategy

### Database Backup

Daily backup with cron:

```bash
0 2 * * * * mysqldump -u zuora_user -p'secure_password' zuora_workflows | gzip > /backups/zuora-workflows-$(date +\%Y\%m\%d).sql.gz
```

Keep 30 days of backups:

```bash
0 3 * * * * find /backups -name "*.sql.gz" -mtime +30 -delete
```

### Application Backup

Backup storage and configuration:

```bash
tar -czf /backups/app-$(date +\%Y\%m\%d).tar.gz \
    /var/www/zuora-workflows/storage \
    /var/www/zuora-workflows/.env
```

---

## Troubleshooting

### 500 Internal Server Error

Check logs:

```bash
tail -f /var/www/zuora-workflows/storage/logs/laravel.log
```

Common causes:
- Missing PHP extensions
- Incorrect permissions
- Database connection issues
- Missing environment variables

### Queue Not Processing

Check Supervisor:

```bash
sudo supervisorctl status zuora-workflows-queue:*
```

Restart if needed:

```bash
sudo supervisorctl restart zuora-workflows-queue:*
```

### Assets Not Loading

Clear and rebuild:

```bash
php artisan view:clear
php artisan cache:clear
yarn run build
```

---

## Scaling Considerations

### Horizontal Scaling

For high traffic:
- Use load balancer (Nginx, HAProxy)
- Multiple application servers
- Shared database server
- Redis cluster for cache/queue

### Performance Optimization

- Enable OPcache
- Use Redis for cache and queue
- Implement CDN for assets
- Enable HTTP/2
- Optimize database queries

---

## Next Steps

- [Getting Started Guide](../guides/getting-started) - Initial setup
- [Configuration Reference](../reference/configuration) - Configure production settings
- [Features Guide](../guides/features) - Learn about features

## Related Documentation

- [Laravel Deployment](https://laravel.com/docs/12.x/deployment)
- [Laravel Forge](https://forge.laravel.com)
- [Nginx Configuration](https://nginx.org/en/docs/)
- [Supervisor Documentation](http://supervisord.org/)
