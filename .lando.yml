name: zuora-workflows
recipe: laravel

config:
  php: '8.4'
  composer_version: '2'
  via: nginx
  webroot: public
  database: mariadb:11.4
  cache: redis
  xdebug: true

services:
  phpmyadmin:
    type: phpmyadmin
    hosts:
      - database
  redis:
    type: redis
  appserver:
    build_as_root:
      - curl -sL https://deb.nodesource.com/setup_24.x | bash -
      - apt-get update -y
      - apt-get install -y nodejs
      - npm install -g yarn
    build:
      - yarn
    ssl: true
    ports:
      - '24690:24690'
      - '24691:24691'
      - '24692:24692'

tooling:
  pint:
    service: appserver
    cmd: ./vendor/bin/pint
  test:
    service: appserver
    cmd: ./vendor/bin/phpunit
  tinker:
    service: appserver
    cmd: php artisan tinker
  artisan:
    service: appserver
    cmd: php artisan
  queue:
    service: appserver
    description: Start the queue worker
    cmd: php artisan queue:work
  schedule:
    service: appserver
    description: Start the scheduler
    cmd: php artisan schedule:work
  node:
    service: appserver
  yarn:
    service: appserver

  dev:
    service: appserver
    description: Start vite dev server
    user: root
    cmd: yarn dev
