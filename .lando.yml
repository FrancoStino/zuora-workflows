name: zuora-workflows
recipe: laravel

config:
  php: '8.4'
  composer_version: '2'
  via: nginx
  webroot: public
  database: mariadb:11.4
  cache: redis
  xdebug: true

services:
  phpmyadmin:
    type: phpmyadmin
    hosts:
      - database
  redis:
    type: redis

proxy:
  phpmyadmin:
    - phpmyadmin.zuora-workflows.lndo.site

events:
  post-start:
    - appserver: |
        composer install
        echo "Clearing caches..."
        php artisan config:clear
        php artisan cache:clear
        php artisan view:clear
        php artisan route:clear
        
        echo "Linking storage..."
        php artisan storage:link 2>/dev/null || echo "Storage link already exists"
        
        echo "Optimizing application..."
        php artisan config:cache
        php artisan route:cache
        php artisan view:cache
        php artisan filament:optimize

tooling:
  pint:
    service: appserver
    cmd: ./vendor/bin/pint
  test:
    service: appserver
    cmd: ./vendor/bin/phpunit
  tinker:
    service: appserver
    cmd: php artisan tinker
  artisan:
    service: appserver
    cmd: php artisan
  queue:
    service: appserver
    description: Start the queue worker
    cmd: php artisan queue:work
  schedule:
    service: appserver
    description: Start the scheduler
    cmd: php artisan schedule:work
